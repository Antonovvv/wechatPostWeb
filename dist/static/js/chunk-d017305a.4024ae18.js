(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d017305a"],{1146:function(t,e,i){},"23e8":function(t,e,i){"use strict";var n=i("2d3c"),a=i.n(n);a.a},"2d3c":function(t,e,i){},4056:function(t,e,i){"use strict";i("68ef"),i("09fe")},"565f":function(t,e,i){"use strict";var n=i("2638"),a=i.n(n),s=i("c31d"),r=i("ad06"),o=i("7744"),l=i("dfaf"),c=i("1325"),u=i("a142");function h(){return!u["d"]&&/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())}var d=i("a8c1"),f=h();function p(){f&&Object(d["e"])(Object(d["b"])())}var m=i("d282"),g=i("ea8e"),v=Object(m["a"])("field"),b=v[0],I=v[1];e["a"]=b({inheritAttrs:!1,props:Object(s["a"])({},l["a"],{error:Boolean,readonly:Boolean,autosize:[Boolean,Object],leftIcon:String,rightIcon:String,clearable:Boolean,labelClass:null,labelWidth:[Number,String],labelAlign:String,inputAlign:String,errorMessage:String,errorMessageAlign:String,type:{type:String,default:"text"}}),data:function(){return{focused:!1}},watch:{value:function(){this.$nextTick(this.adjustSize)}},mounted:function(){this.format(),this.$nextTick(this.adjustSize)},computed:{showClear:function(){return this.clearable&&this.focused&&""!==this.value&&Object(u["b"])(this.value)&&!this.readonly},listeners:function(){var t=Object(s["a"])({},this.$listeners,{input:this.onInput,keypress:this.onKeypress,focus:this.onFocus,blur:this.onBlur});return delete t.click,t},labelStyle:function(){var t=this.labelWidth;if(t)return{width:Object(g["a"])(t)}}},methods:{focus:function(){this.$refs.input&&this.$refs.input.focus()},blur:function(){this.$refs.input&&this.$refs.input.blur()},format:function(t){if(void 0===t&&(t=this.$refs.input),t){var e=t,i=e.value,n=this.$attrs.maxlength;return"number"===this.type&&Object(u["b"])(n)&&i.length>n&&(i=i.slice(0,n),t.value=i),i}},onInput:function(t){t.target.composing||this.$emit("input",this.format(t.target))},onFocus:function(t){this.focused=!0,this.$emit("focus",t),this.readonly&&this.blur()},onBlur:function(t){this.focused=!1,this.$emit("blur",t),p()},onClick:function(t){this.$emit("click",t)},onClickLeftIcon:function(t){this.$emit("click-left-icon",t)},onClickRightIcon:function(t){this.$emit("click-right-icon",t)},onClear:function(t){Object(c["c"])(t),this.$emit("input",""),this.$emit("clear",t)},onKeypress:function(t){if("number"===this.type){var e=t.keyCode,i=-1===String(this.value).indexOf("."),n=e>=48&&e<=57||46===e&&i||45===e;n||Object(c["c"])(t)}"search"===this.type&&13===t.keyCode&&this.blur(),this.$emit("keypress",t)},adjustSize:function(){var t=this.$refs.input;if("textarea"===this.type&&this.autosize&&t){t.style.height="auto";var e=t.scrollHeight;if(Object(u["c"])(this.autosize)){var i=this.autosize,n=i.maxHeight,a=i.minHeight;n&&(e=Math.min(e,n)),a&&(e=Math.max(e,a))}e&&(t.style.height=e+"px")}},renderInput:function(){var t=this.$createElement,e=this.slots("input");if(e)return t("div",{class:I("control",this.inputAlign)},[e]);var i={ref:"input",class:I("control",this.inputAlign),domProps:{value:this.value},attrs:Object(s["a"])({},this.$attrs,{readonly:this.readonly}),on:this.listeners,directives:[{name:"model",value:this.value}]};return"textarea"===this.type?t("textarea",a()([{},i])):t("input",a()([{attrs:{type:this.type}},i]))},renderLeftIcon:function(){var t=this.$createElement,e=this.slots("left-icon")||this.leftIcon;if(e)return t("div",{class:I("left-icon"),on:{click:this.onClickLeftIcon}},[this.slots("left-icon")||t(r["a"],{attrs:{name:this.leftIcon}})])},renderRightIcon:function(){var t=this.$createElement,e=this.slots,i=e("right-icon")||this.rightIcon;if(i)return t("div",{class:I("right-icon"),on:{click:this.onClickRightIcon}},[e("right-icon")||t(r["a"],{attrs:{name:this.rightIcon}})])}},render:function(){var t,e=arguments[0],i=this.slots,n=this.labelAlign,a={icon:this.renderLeftIcon};return i("label")&&(a.title=function(){return i("label")}),e(o["a"],{attrs:{icon:this.leftIcon,size:this.size,title:this.label,center:this.center,border:this.border,isLink:this.isLink,required:this.required,clickable:this.clickable,titleStyle:this.labelStyle,titleClass:[I("label",n),this.labelClass],arrowDirection:this.arrowDirection},class:I((t={error:this.error,disabled:this.$attrs.disabled},t["label-"+n]=n,t["min-height"]="textarea"===this.type&&!this.autosize,t)),scopedSlots:a,on:{click:this.onClick}},[e("div",{class:I("body")},[this.renderInput(),this.showClear&&e(r["a"],{attrs:{name:"clear"},class:I("clear"),on:{touchstart:this.onClear}}),this.renderRightIcon(),i("button")&&e("div",{class:I("button")},[i("button")])]),this.errorMessage&&e("div",{class:I("error-message",this.errorMessageAlign)},[this.errorMessage])])}})},bcd3:function(t,e,i){},c514:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"sellIndex"}},[i("van-divider",{attrs:{id:"divider"}},[t._v("上传图片")]),i("van-cell-group",{attrs:{id:"inputPanel"}},[i("van-field",{attrs:{clearable:"",label:"名称",placeholder:"请输入上传图片的名称"},model:{value:t.postName,callback:function(e){t.postName=e},expression:"postName"}}),i("van-cell",{attrs:{title:"添加图片",clickable:""},on:{click:t.loadImage}},[i("van-icon",{staticStyle:{"line-height":"inherit"},attrs:{slot:"right-icon",name:"plus"},slot:"right-icon"})],1)],1),i("van-uploader",{staticStyle:{"margin-left":"5%"},attrs:{"max-count":6,disabled:"","preview-size":"100px"},on:{delete:t.delPreview},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}}),i("div",{attrs:{id:"uploadButton"}},[i("van-button",{attrs:{disabled:t.isUploading,loading:t.isUploading,type:"primary","loading-text":"上传中...","loading-type":"spinner"},on:{click:t.upload}},[t._v("上传图片")])],1)],1)},a=[],s=(i("e7e5"),i("d399")),r=i("bd86"),o=(i("68ef"),i("09fe"),i("ad06")),l=(i("66b9"),i("b650")),c=(i("4056"),i("44bf")),u=(i("4d75"),i("8270"),i("786d"),i("504b"),i("bcd3"),i("c31d")),h=i("d282"),d=i("ea8e"),f=i("a142");function p(t){return Array.isArray(t)?t:[t]}function m(t,e){return new Promise((function(i){var n=new FileReader;n.onload=function(t){i(t.target.result)},"dataUrl"===e?n.readAsDataURL(t):"text"===e&&n.readAsText(t)}))}function g(t,e){return p(t).some((function(t){return t.size>e}))}var v=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function b(t){return v.test(t)}function I(t){return!!t.isImage||(t.file&&t.file.type?0===t.file.type.indexOf("image"):t.url?b(t.url):!!t.content&&0===t.content.indexOf("data:image"))}var y,w=i("28a2"),$=Object(h["a"])("uploader"),k=$[0],x=$[1],S=k({inheritAttrs:!1,model:{prop:"fileList"},props:{disabled:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:Number,default:Number.MAX_VALUE},maxCount:{type:Number,default:Number.MAX_VALUE},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"}},computed:{previewSizeWithUnit:function(){return Object(d["a"])(this.previewSize)}},methods:{getDetail:function(t){return void 0===t&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var e=this,i=t.target.files;if(!this.disabled&&i.length){if(i=1===i.length?i[0]:[].slice.call(i),this.beforeRead){var n=this.beforeRead(i,this.getDetail());if(!n)return void this.resetInput();if(n.then)return void n.then((function(){e.readFile(i)})).catch(this.resetInput)}this.readFile(i)}},readFile:function(t){var e=this,i=g(t,this.maxSize);if(Array.isArray(t)){var n=this.maxCount-this.fileList.length;t.length>n&&(t=t.slice(0,n)),Promise.all(t.map((function(t){return m(t,e.resultType)}))).then((function(n){var a=t.map((function(t,e){return{file:t,content:n[e]}}));e.onAfterRead(a,i)}))}else m(t,this.resultType).then((function(n){e.onAfterRead({file:t,content:n},i)}))},onAfterRead:function(t,e){e?this.$emit("oversize",t,this.getDetail()):(this.resetInput(),this.$emit("input",[].concat(this.fileList,p(t))),this.afterRead&&this.afterRead(t,this.getDetail()))},onDelete:function(t,e){var i=this;if(this.beforeDelete){var n=this.beforeDelete(t,this.getDetail(e));if(!n)return;if(n.then)return void n.then((function(){i.deleteFile(t,e)})).catch(f["e"])}this.deleteFile(t,e)},deleteFile:function(t,e){var i=this.fileList.slice(0);i.splice(e,1),this.$emit("input",i),this.$emit("delete",t,this.getDetail(e))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(t){var e=this;if(this.previewFullImage){var i=this.fileList.filter((function(t){return I(t)})),n=i.map((function(t){return t.content||t.url}));Object(w["a"])({images:n,closeOnPopstate:!0,startPosition:i.indexOf(t),onClose:function(){e.$emit("close-preview")}})}},renderPreviewItem:function(t,e){var i=this,n=this.$createElement,a=n(o["a"],{attrs:{name:"delete"},class:x("preview-delete"),on:{click:function(n){n.stopPropagation(),i.onDelete(t,e)}}}),s=I(t)?n(c["a"],{attrs:{fit:this.imageFit,src:t.content||t.url,width:this.previewSize,height:this.previewSize},class:x("preview-image"),on:{click:function(){i.onPreviewImage(t)}}}):n("div",{class:x("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[n(o["a"],{class:x("file-icon"),attrs:{name:"description"}}),n("div",{class:[x("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url])]);return n("div",{class:x("preview"),on:{click:function(){i.$emit("click-preview",t,i.getDetail(e))}}},[s,a])},renderPreviewList:function(){if(this.previewImage)return this.fileList.map(this.renderPreviewItem)},renderUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var e,i=this.slots(),n=t("input",{attrs:Object(u["a"])({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:x("input"),on:{change:this.onChange}});if(i)return t("div",{class:x("input-wrapper")},[i,n]);if(this.previewSize){var a=this.previewSizeWithUnit;e={width:a,height:a}}return t("div",{class:x("upload"),style:e},[t(o["a"],{attrs:{name:"plus"},class:x("upload-icon")}),this.uploadText&&t("span",{class:x("upload-text")},[this.uploadText]),n])}}},render:function(){var t=arguments[0];return t("div",{class:x()},[t("div",{class:x("wrapper")},[this.renderPreviewList(),this.renderUpload()])])}}),j=(i("2b28"),i("9ed2")),O=(i("1146"),i("565f")),L=i("34e9"),z=(i("7f7f"),i("7744")),A=i("bc3a"),D=i.n(A),C=i("18a0"),U=i.n(C),N={components:(y={},Object(r["a"])(y,z["a"].name,z["a"]),Object(r["a"])(y,L["a"].name,L["a"]),Object(r["a"])(y,O["a"].name,O["a"]),Object(r["a"])(y,j["a"].name,j["a"]),Object(r["a"])(y,S.name,S),Object(r["a"])(y,c["a"].name,c["a"]),Object(r["a"])(y,l["a"].name,l["a"]),Object(r["a"])(y,o["a"].name,o["a"]),y),data:function(){return{postName:"",fileList:[],isUploading:!1,localIds:[],serverIds:[]}},computed:{nickname:function(){return this.$store.state.nickname},openid:function(){return this.$store.state.openid},formData:function(){var t=new FormData;return t},imageNum:function(){return this.localIds.length}},methods:{loadImage:function(){var t=this;U.a.chooseImage({count:6-this.imageNum,success:function(e){var i=t.imageNum;t.localIds=t.localIds.concat(e.localIds),t.getPreview(i,i+e.localIds.length)}})},test:function(){},delPreview:function(t){this.localIds.splice(t,1)},getPreview:function(t,e){var i=this;U.a.getLocalImgData({localId:this.localIds[t],success:function(n){var a=n.localData;0!=a.indexOf("data:image")&&(a="data:image/jpeg;base64,"+a),i.fileList.push({url:a,isImage:!0}),t+=1,t<e&&i.getPreview(t,e)}})},upload:function(){this.isUploading=!0,null==this.$store.state.openid?(s["a"].fail("微信登陆信息为空，请重新进入"),this.isUploading=!1):""==this.postName?(Object(s["a"])("请输入名称"),this.isUploading=!1):0==this.imageNum?(Object(s["a"])("请添加图片"),this.isUploading=!1):this.uploadToWx(0)},uploadToWx:function(t){var e=this;U.a.uploadImage({localId:this.localIds[t],isShowProgressTips:1,success:function(i){e.serverIds.push(i.serverId),t+=1,t<e.imageNum?e.uploadToWx(t):e.uploadToServer()}})},uploadToServer:function(){var t=this;this.formData.set("postname",this.postName),this.formData.set("nickname",this.nickname),this.formData.set("openid",this.openid),this.formData.set("serverids",this.serverIds);var e=this.$store.state.serverurl+"/api/uploadimgs",i={headers:{"Content-Type":"multipart/form-data;"}};D.a.post(e,this.formData,i).then((function(e){e.data.openid==t.openid?(s["a"].success("上传成功"),t.postName="",t.fileList=[],t.localIds=[],t.serverIds=[]):"failed"==e.data.error?s["a"].fail("上传失败"):s["a"].fail("未知错误"),t.isUploading=!1})).catch((function(e){alert(e),s["a"].fail("上传失败"),t.isUploading=!1}))}},watch:{},mounted:function(){}},P=N,F=(i("23e8"),i("2877")),T=Object(F["a"])(P,n,a,!1,null,null,null);e["default"]=T.exports}}]);
//# sourceMappingURL=chunk-d017305a.4024ae18.js.map